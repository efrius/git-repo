# Блок описания конфигурации DHS-сервера Unbound
server:

# Используемые для управления ресурсы
directory: "/etc/unbound"
pidfile: "/var/run/unbound.pid"

# Имя пользователя, от которого запускается сервис
username: unbound

# Запускаем в несколько потоков (по одному на ядро процессора)
num-threads: 1

# Данные параметры соотносятся с числом потоков*2
msg-cache-slabs: 2
rrset-cache-slabs: 2
infra-cache-slabs: 2
key-cache-slabs: 2

# Включаем оптимизацию быстрого перераспределения ресурсов
so-reuseport: yes

# Описываем параметры сетевого подключения, на котором сервис принимает запросы
port: 53
interface: 0.0.0.0
interface: ::0

# Опционально указываем, с какого из интерфейсов отвечать на запросы и высылать рекурсивные запросы
outgoing-interface: 95.216.147.65
outgoing-interface: 2a01:4f9:c010:1b40::1
  
# Уточняем перечень протоколов, с которыми работаем
do-ip4: yes
do-ip6: yes
do-udp: yes
do-tcp: yes
prefer-ip6: yes

#Определяем частные подсети, имена которых не должны возвращаться в Интернет
private-address: 10.0.0.0/8
private-address: fd42:42:42::/48
  
# Перечисляем сети, рекурсивные запросы от которых обслуживаются (по умолчанию всё неразрешенное запрещено)
access-control: 127.0.0.0/8 allow
access-control: 10.0.0.0/8 allow
access-control: fd42:42:42::/48 allow

# Скрываем данные о программном обеспечении в ответах на запросы
hide-identity: yes
hide-version: yes
hide-trustanchor: yes
identity: "DNS"

# Уровень детализации журнала событий (0 - только ошибки; 1 - каждый запрос; 3 - детальный разбор)
verbosity: 1

# На период отладки полезно включить детальное журналирование запросов пользователей
log-queries: yes

# Месторасположение файла журнала событий
logfile: "/var/log/unbound.log"

# Использовать в журнале человекопонятный формат метки времени
log-time-ascii: yes

# Предписываем не дублировать сообщения о событиях в системный журнал
use-syslog: no

# Подставляем актуальный перечень корневых DNS-серверов (скачиваем отсюда: "ftp://ftp.internic.net/domain/named.cache")
root-hints: "/etc/unbound/root.hints"

# The following line will configure unbound to perform cryptographic
# DNSSEC validation using the root trust anchor.

module-config: "validator iterator"
auto-trust-anchor-file: "/etc/unbound/root.key"
aggressive-nsec: yes
cache-max-ttl: 86400
cache-min-ttl: 3600
minimal-responses: yes
prefetch: yes
serve-expired: yes
interface-automatic: yes
qname-minimisation: yes
qname-minimisation-strict: yes
rrset-roundrobin: yes
use-caps-for-id: yes
rrset-cache-size: 256m
msg-cache-size: 128m
so-rcvbuf: 4m
so-sndbuf: 4m
delay-close: 10000
ratelimit: 1000
do-daemonize: no
harden-algo-downgrade: yes
harden-below-nxdomain: yes
harden-glue: yes
harden-dnssec-stripped: yes
harden-short-bufsize: yes
harden-referral-path: no
infra-cache-numhosts: 100000
outgoing-range: 8192
num-queries-per-thread: 4096
unwanted-reply-threshold: 10000
target-fetch-policy: "0 0 0 0 0"
val-clean-additional: yes
incoming-num-tcp: 1000
outgoing-num-tcp: 1000
edns-buffer-size: 1232
deny-any: yes
ssl-upstream: yes
tls-cert-bundle: /etc/ssl/certs/ca-certificates.crt


forward-zone:
    name: "google.com"
	forward-tls-upstream: yes
	forward-addr: 8.8.4.4@853#dns.google
	forward-addr: 8.8.8.8@853#dns.google
	forward-addr: 2001:4860:4860::8888@853#dns.google
	forward-addr: 2001:4860:4860::8844@853#dns.google

forward-zone:
    name: "."
	forward-tls-upstream: yes
	forward-addr: 2001:67c:27e4::35@853#privacydns.go6lab.si	
    forward-addr: 37.252.185.232@443#dot1.appliedprivacy.net # The Primary appliedprivacy.net DNS TLS Server
	forward-addr: 2a00:63c1:a:229::3@443#dot1.appliedprivacy.net
    forward-addr: 176.56.236.175@853#dns.aaflalo.me # The dns.aaflalo.me DNS TLS Server
    forward-addr: 159.69.198.101@853#dot-de.blahdns.com # The BlahDNS German DNS TLS Server
	forward-addr: 2a01:4f8:1c1c:6b4b::1@853#dot-de.blahdns.com
    forward-addr: 108.61.201.119@853#dot-jp.blahdns.com # The BlahDNS Japan DNS TLS Server
	forward-addr: 2001:19f0:7001:1ded:5400:01ff:fe90:945b@853#dot-jp.blahdns.com
    forward-addr: 89.234.186.112@443#dns.neutopia.org # The dns.neutopia.org  DNS TLS Server
	forward-addr: 2a00:5884:8209::2@853#dns.neutopia.org
    forward-addr: 139.99.222.72@853#dot.seby.io # The dns.seby.io - Vultr DNS TLS Server
    forward-addr: 185.95.218.43@853#dns.digitale-gesellschaft.ch # The dns.digitale-gesellschaft.ch DNS TLS Server
    forward-addr: 185.95.218.42@853#dns.digitale-gesellschaft.ch # The dns.digitale-gesellschaft.ch  DNS TLS Server # 2
	forward-addr: 174.138.29.175@853#dot.tiar.app # The dot.tiar.app DNS TLS Server
	forward-addr: 149.112.112.112@853#dns.quad9.net
	forward-addr: 2620:fe::fe@853#dns.quad9.net

remote-control:
control-enable: yes
control-interface: 127.0.0.1
control-port: 953
server-key-file: "unbound_server.key"
server-cert-file: "unbound_server.pem"
control-key-file: "unbound_control.key"
control-cert-file: "unbound_control.pem"